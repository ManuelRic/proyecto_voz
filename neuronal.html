<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AI Voice TTS (ElevenLabs)</title>
  <style>
    @font-face {
        font-family: 'CalSans';
        src: url('fonts/CalSans-Regular.ttf') format('truetype');
      }

    html{
      font-family: 'CalSans', sans-serif;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #121212;
      color: #333;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
    }

    h2 {
      margin-bottom: 20px;
      color: #c87100;
    }

    textarea {
      width: 90%;
      max-width: 600px;
      padding: 15px;
      font-size: 16px;
      border: 2px solid #ccc;
      border-radius: 10px;
      resize: vertical;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    }

    button {
      width: 33%;
      margin-top: 20px;
      padding: 12px 24px;
      font-size: 16px;
      font-weight: bold;
      color: white;
      background-color: #ffa600;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      transition: background-color 0.3s ease;
    }

    #speak_button{
      cursor: pointer;
      filter: invert(90%);
      width: 65px;
    }

    #speak_button:hover{
      filter: invert(80%);
    }

    #back_button{
      cursor: pointer;
      position: absolute;
      top: 0;
      left: 0;
      filter: invert(90%);
      width: 80px;
      margin: 20px;
    }

    #back_button:hover{
      filter: invert(80%);
    }

    #recomendacion {
      display: none;
      position: absolute;
      left: 66%;
      top: 29%;
      width: 20%; 
      background: #ff7b00; 
      border-width: 3px;
      padding: 15px; 
      border-radius: 12px; 
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.2); 
      color: #fff8ed; 
      font-size: 16px; 
      font-weight: bold; 
      animation: popUp 0.3s ease-out;
    }

    @keyframes popUp {
      from {
        opacity: 0;
        transform: scale(0.8);
      }
      
      to {
        opacity: 1;
        transform: scale(1);
      }
    }


  </style>
</head>
<body>
  <h2>üó£Ô∏è TTS Neuronal</h2>
  <textarea id="text-input" rows="4" cols="50">¬øQu√© tal? Si quieres puedes introducir tu propio texto, esta IA est√° dise√±ada para hablar en ingl√©s.</textarea><br>
  
  <p id="recomendacion">Recomendaci√≥n: Emplea exclamaciones (!) e interrogantes (?) en tus frases para apreciar mejor el avance del TTS neuronal. Incluso puedes usar varias a la vez.</p>

  <img id="speak_button" src="img/ev_1/play.png" onclick="speak()">

  <img id="back_button" src="img/ev_1/home.png">

<script>
  let currentAudio = null; // Track the current audio

  async function speak() {
    const text = document.getElementById("text-input").value;

    const API_KEY = "sk_e27aaae585ccfdc6de7199496caa0ce9a88e92507fe6f494";
    const VOICE_ID = "Xb7hH8MSUJpSbSDYk0k2";

    // Stop any previously playing audio
    if (currentAudio && !currentAudio.paused) {
      currentAudio.pause();
      currentAudio.currentTime = 0;
    }

    try {
      const response = await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${VOICE_ID}`, {
        method: "POST",
        headers: {
          "xi-api-key": API_KEY,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          text: text,
          model_id: "eleven_monolingual_v1",
          voice_settings: {
            stability: 0.5,
            similarity_boost: 0.5
          }
        })
      });

      if (!response.ok) {
        throw new Error(`Error: ${response.statusText}`);
      }

      const blob = await response.blob();
      const audioUrl = URL.createObjectURL(blob);
      currentAudio = new Audio(audioUrl);
      currentAudio.play();

    } catch (error) {
      alert("Something went wrong: " + error.message);
      console.error(error);
    }
  }

  document.addEventListener("DOMContentLoaded", function () {
    // Back button functionality
    const backButton = document.getElementById("back_button");

    backButton.addEventListener("click", function () {
      window.location.href = "page_1.html";
    });
  });

  // Show tip only once for a few seconds
  let tipShown = false;

  const textarea = document.getElementById("text-input");
  const tip = document.getElementById("recomendacion");

  textarea.addEventListener("input", () => {
    if (!tipShown) {
      tip.style.display = "block";
      tipShown = true;

      setTimeout(() => {
        tip.style.display = "none";
      }, 8000);
    }
  });
</script>

</body>
</html>
